---
description: Optimized workflow for generating word puzzles with unique bigrams
alwaysApply: true
---

# Puzzle Generation Workflow

When asked to create, generate, or add puzzles, follow this workflow optimized for token efficiency.

## Step 1: Read the Creation Guide

Read `PUZZLE_CREATION_GUIDE.md` for puzzle rules and difficulty guidelines (EASY/HARD/IMPOSSIBLE criteria).

**Do NOT read `puzzles.ts`** - it's huge and unnecessary for uniqueness checking.
**Do NOT read the full `bigram-index.txt`** - it's 50KB+ and grows over time.

## Step 2: Identify "Golden Words" (Optional Quick Check)

Use targeted grep to find words with NO existing entries - these are ideal chain anchors:

```bash
rg "^TARGETWORD→|→TARGETWORD$" bigram-index.txt
```

Words with zero matches are "golden" - any compound using them as the first element will be unique.

## Step 3: Generate and Validate with Script-First Approach

**Use the script for validation directly** - it gives instant, precise feedback:

```bash
node scripts/add-puzzle.js \
  --solution "WORD1" "WORD2" ... "WORD9" \
  --narrative "Your narrative..." \
  --difficulty EASY|HARD|IMPOSSIBLE
```

- If it succeeds: puzzle is added, move to next
- If it fails: read the conflict list, fix ONLY those pairs, retry

## Step 4: Iterate Efficiently

- Fix only the conflicting bigrams identified by the script
- Maximum 3-4 attempts per chain concept
- If hitting 5+ failures on one chain, abandon it and try completely different word roots
- Target: <5 script calls per successful puzzle

## Efficiency Rules

**DO:**
- Use script validation as your primary uniqueness check
- Start chains with uncommon words (foods, plants, proper nouns)
- Run multiple puzzle attempts in parallel when possible
- Trust the script's error output - it's precise

**DO NOT:**
- Grep every single bigram before attempting (too slow for saturated indexes)
- Read the entire bigram-index.txt into context
- Spend 10+ attempts fixing the same chain - pivot instead
- Pre-validate more than 2-3 key bigrams per chain

## Why This Approach

The bigram index is now large (3500+ entries). Pre-checking every bigram via grep costs more tokens than just running the script and iterating on failures. The script validates all 8 bigrams instantly and tells you exactly which ones conflict.
